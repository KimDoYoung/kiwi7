{% extends 'common/base.html' %}
{% block style %}
{% endblock %}
{% block content %}
<div x-data="data_settings"  class="container mt-4">
    <h2>설정 편집</h2>
    <div class="mt-3">
        <button type="button" class="btn btn-primary" @click="issue_new_token()">키움 토큰 재발급</button>
        <div x-show="result" class="alert alert-info mt-3" x-text="result"></div>
    </div>
    <div class="mt-3">
        <button type="button" class="btn btn-primary" @click="fill_stk_info()">주식종목정보 채우기</button>
        <div x-show="result_fill_stk_info" class="alert alert-info mt-3" x-text="result_fill_stk_info"></div>
    </div>
</div>
{% raw %}
<!--handlebar scripts-->
{% endraw %}
{% endblock %}
{% block script %}
{% raw %}
<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('data_settings', () => ({
            data: null,
            result : null,
            result_fill_stk_info: null, //stk_info채우기
            init() {
                console.log('Initializing data_settings');
            },
            issue_new_token(){
                console.log('토큰 재발급요청...');
                getFetch('/api/v1/kiwoom/issue-new-token')
                    .then(response => {
                        console.log(response)
                        if (response.success) {
                            this.result = '토큰이 성공적으로 재발급되었습니다.';
                        } else {
                            this.result = '토큰 재발급에 실패했습니다. 관리자에게 문의하세요.' + error.message;
                        }
                    })
                    .catch(error => {
                        console.error('토큰 재발급 오류:', error);
                        this.result = '토큰 재발급에 실패했습니다. 관리자에게 문의하세요.' + error.message;
                    });
            },
            fill_stk_info(){
                console.log("stk_info 테이블 채우기")
                putFetch('/api/v1/settings/stk_info?force=true')
                    .then(response => {
                        console.log(response)
                        if (response.success) {
                            this.result_fill_stk_info = 'stk_info 테이블이 성공적으로 채워졌습니다.';
                        } else {
                            this.result_fill_stk_info = 'stk_info 테이블 채우기에 실패했습니다. 관리자에게 문의하세요.' + error.message;
                        }
                    })
                    .catch(error => {
                        console.error('stk_info 테이블 채우기 오류:', error);
                        this.result_fill_stk_info = 'stk_info 테이블 채우기에 실패했습니다. 관리자에게 문의하세요.' + error.message;
                    });
            }
        }));
    });
</script>
{% endraw %}
{% endblock %}